<html xmlns:hwk="http://udfv.com/hwk/">
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>UDFV Document</title>
<link href="udfv.css" rel="stylesheet">
</head>
<body>
<h1 class="banner">UDFV Document</h1>
<div align="right">
(C) 2005 Heart Solutions, Inc.
</div>
<div class="chaptor">
<h1>1. UDFV tools</h1>
</div>
<div class="section">
<h2>1.1. UDFV tools について</h2>
<p>
UDFVライブラリでは、以下の機能を持つツール群を提供しています。</p>
<ul>
<li> ディスクイメージファイルの UDF ファイルシステムの情報から XML ドキュメントファイルを作成する。</li>
<li> UDF ファイルシステムの情報の XML ドキュメントファイルからディスクイメージファイルを作成する。</li>
<li> UDF ファイルシステムの情報の XML ドキュメントファイルを読み取り XML ドキュメントを出力する。</li>
<li> ディスクイメージおよびXML ドキュメントファイル上の UDF ファイルシステムの整合性を検証する。</li>
<li> UDF ファイルシステムの情報の XML ドキュメントファイルの整合性を取り XML ドキュメントを出力する。</li>
</ul>
<p>
これらのツールは、samplesディレクトリに格納されています。またツールで生成・使用されるXMLについては、XMLの項を参照してください。</p>
<p>
この項では、ツールの詳細と使用方法について解説します。</p>
</div>
<div class="section">
<h2>1.2. UDFV tools 実行の前に</h2>
<p>
UDFVライブラリを使用するためにはUDFVライブラリへのクラスパスの指定と、XML パーサーライブラリへのクラスパスの指定が必要となります。</p>
<p>
FreeBSD や Linux などの PC-UNIX 環境でコマンドラインオプションとして指定するときは、次のようになります。</p>
<pre>
例）カレントディレクトリに udfv.jar ファイルがあり、Xerces2 Java Parser 2.6.2 Release が
    カレントディレクトリに展開されている場合。

&gt; java -Xmx64m -cp ./udfv.jar:./xerces_2_6_2/xercesImpl.jar:./xerces_2_6_2/xml-apis.jar com.udfv.test.VerifyImg ....
</pre>
<p>

</p>
<p>
 Windows 2000 や Windows XP ではクラスパスの区切り文字が異なり、コロンではなく、セミコロンで指定する必要があります。</p>
<pre>
例）Windows 2000, XP の場合。

C:\UDFV&gt; java -Xmx64m -cp .\udfv.jar;.\xerces_2_6_2\xercesImpl.jar;.\xerces_2_6_2\xml-apis.jar com.udfv.test.VerifyImg ....
</pre>
<p>

</p>
<p>
コマンドラインオプションで指定することを省きたい場合は、クラスパスを環境変数に設定する、もしくは JRE の拡張用ディレクトリに各ライブラリを複写する、などのことを行っておきます。</p>
<p>
参考）Windows XP に JRE をインストールした場合の拡張用ディレクトリ。</p>
<p>
C:\Program Files\Java\jre1.4.2_08\lib\ext\</p>
<p>
このディレクトリはインストール時の設定によって変化します。詳細は Sun の Java Web ページをご覧ください。</p>
<p>
複雑な構造やファイルを多数持つ UDF ファイルシステムの解析にはVirtual Machine(以下、VMとします)に多くのメモリを必要とすることがあります。そのときはオプションの指定で適切なメモリをVMに割り当ててください。Java の実行オプションについては Sun のドキュメントをご覧ください。</p>
</div>
<div class="section">
<h2>1.3. UDFV toolsの実行</h2>
<p>
ここでは XML パーサーライブラリが Java 実行環境の拡張ディレクトリに複写されていて、UDFVライブラリがカレントディレクトリに存在するものと仮定します。</p>
<p>
なお、PC-UNIX環境であれば、samplesディレクトリに格納されているシェルスクリプトを使用することもできます。</p>
</div>
<div class="section">
<h3>1.3.1. Image file to XML Document 'Img2xml'</h3>
<p>
  ディスクイメージファイルの UDF ファイルシステムの情報から XML ドキュメントファイルを作成します。</p>
<p>
各OS環境のコマンドライン実行環境（コマンドプロンプトやターミナルなど）で第一引数にディスクイメージ名を渡してcom.udfv.test.Img2xml を実行します。 XML ドキュメントが標準出力されます。</p>
<p>
例）  &gt; java -Xmx64m -cp ./udfv.jar com.udfv.test.Img2xml DVD_VR.IMG &gt; DVD_VR.XML</p>
</div>
<div class="section">
<h3>1.3.2. XML Document to Image file 'Xml2img'</h3>
<p>
  UDF ファイルシステムの情報の XML ドキュメントファイルからディスクイメージファイルを作成します。</p>
<p>
各OS環境のコマンドライン実行環境で第一引数に XML ドキュメントファイル名を、第二引数にディスクイメージ名を渡して com.udfv.test.Xml2img を実行します。</p>
<p>
例）  &gt; java -Xmx64m -cp ./udfv.jar com.udfv.test.Xml2img DVD_VR.XML DVD_VR.IMG</p>
</div>
<div class="section">
<h3>1.3.3. UDFV Verifier 'VerifyImg'</h3>
<p>
  ディスクイメージファイルの UDF ファイルシステムの整合性を検証します。</p>
<p>
各OS環境のコマンドライン実行環境で第一引数にディスクイメージ名を渡してcom.udfv.test.VerifyImg を実行します。検証結果が標準出力されます。</p>
<p>
例）   &gt; java -Xmx64m -cp ./udfv.jar com.udfv.test.VerifyImg DVD_VR.IMG &gt; REPORT.TXT</p>
</div>
<div class="section">
<h3>1.3.4. UDFV Verifier 'VerifyXML'</h3>
<p>
  XML ドキュメントファイルの UDF ファイルシステムの整合性を検証します。</p>
<p>
各OS環境のコマンドライン実行環境で第一引数にディスクイメージ名を渡してcom.udfv.test.VerifyXML を実行します。検証結果が標準出力されます。</p>
<p>
例）   &gt; java -Xmx64m -cp ./udfv.jar com.udfv.test.VerifyXML DVD_VR.XML &gt; REPORT.TXT</p>
</div>
<div class="section">
<h3>1.3.5. Recalculate XML Document 'RecalcXML'</h3>
<p>
  UDF ファイルシステムの情報の XML ドキュメントファイルの整合性を取り XML ドキュメントを出力します。</p>
<p>
このツールは、XML ドキュメントを手で修正した場合などに、その修正に伴って修正しなければならないその他の値(CRCなど)を自動的に計算し直し、新たな XML ドキュメントとして出力します。標準では、以下の値を再計算します。</p>
<ul>
<li>descriptor tagのtag-loc、checksumおよびCRC</li>
<li>Space Bitmapのbitmap(Metadata Bitmapも含む)</li>
<li>Logical Volume Integrity DescriptorのFree Space Table</li>
<li>UDF_pad エレメントのデータ部と、sizeアトリビュートの値</li>
</ul>
<p>
各OS環境のコマンドライン実行環境で第一引数にディスクイメージ名を渡してcom.udfv.test.RecalcXML を実行します。 XML ドキュメントが標準出力されます。</p>
<p>
例）  &gt; java -Xmx64m -cp ./udfv.jar com.udfv.test.RecalcXML DVD_VR.XML &gt; DVD_VR_NEW.XML</p>
</div>
<div class="section">
<h3>1.3.6. UDFVGui 'UDFVGui'</h3>
<p>
  ImageおよびXMLを操作する Java Swingを用いた GUIツールです。</p>
<p>
例）  &gt; java -Xmx64m -cp ./udfv.jar com.udfv.gui.UDFVGui</p>
</div>
<div class="section">
<h2>1.4. 各種オプション</h2>
<p>
UDFV tools では、以下のコマンドラインオプションが共通で指定できます。</p>
<pre>
 -ecc_blocksize &lt;n&gt;

 ECCブロックサイズをバイトで指定します。
 このオプションを省略した場合、media_typeがDVD系メディアである場合は32768に、
 BD系メディアである場合は65536に自動的に設定されます。
</pre>
<p>

</p>
<pre>
 -filecopy &lt;true or false&gt;

 このオプションは、Xml2imgでのみ有効です。

 Xml2imgを使用してXMLをイメージファイルに変換する際、
 UDFファイルシステム内に存在するファイルのデータをコピーするかどうかを指定します。
 ファイルサイズが大きい場合に、XMLをイメージに変換する時間を大幅に短縮できます。

 このオプションはtrueまたはfalseのみ指定可能です。
 また省略した場合、filecopyはtrueとなります。
</pre>
<p>

</p>
<pre>
 -media_type &lt;n&gt;

 メディアの種類を数値で指定します。
 このオプションを省略した場合、値は2(DVD-RW)に設定されます。
 n の値とそれに対応するメディアは以下の通りです。

   0   DVD-ROM
   1   DVD-RAM
   2   DVD-RW
   3   DVD-R
   4   DVD+R
   5   DVD+RW
   8   CD-R
   9   CD-RW
   10  CD-ROM
   16  BD-ROM
   17  BD-R
   18  BD-RE
</pre>
<p>

</p>
<pre>
 -media_mode &lt;n&gt;

 メディアのモード(アクセスタイプ)を数値で指定します。
 このオプションを省略した場合、値は4(Overwritable)に設定されます。
 n の値とそれに対応するモードは以下の通りです。

   0  Pseudo overwrite (POW)
   1  Read only (RO)
   2  Write once (WO)
   3  Rewritable (RW)
   4  Overwritable (OW)
</pre>
<p>

</p>
<pre>
 -nolvid

 このオプションは、RecalcXMLのみ有効です。

 このオプションを指定すると、Logical Volume Integrity Descriptorの再計算を行いません。
 Free Space TableやSize Table、Number of Partitions等の値がそのまま残されます。
</pre>
<p>

</p>
<pre>
 -nosb

 このオプションは、RecalcXMLのみ有効です。

 このオプションを指定すると、Space Bitmapのbitmapの再計算を行いません。
 Space Bitmap DescriptorのDescriptor Tagの再計算は行われます。
</pre>
<p>

</p>
<pre>
 -udf_revision &lt;n&gt;

 このオプションは、VerifyImgおよびVerifyXMLのみ有効です。

 検証の対象となるイメージファイル(またはXMLファイル)を、
 強制的にnで指定されたリビジョンのファイルシステムとして検証します。
 n の値とそれに対応するリビジョンは以下の通りです。

 102   UDF 1.02 として検証します。
 150   UDF 1.50 として検証します。
 200   UDF 2.00 として検証します。
 201   UDF 2.01 として検証します。
 250   UDF 2.50 として検証します。
 260   UDF 2.60 として検証します。
</pre>
<p>

</p>
<pre>
 -sortxml &lt;true or false&gt;

 このオプションは、Img2xmlおよびXml2xmlのみ有効です。

 UDFVでは、XMLを出力する際に各エレメントタグのLBN・LSN値を調べ、
 昇順にソートしてから出力しています。このオプションをfalseにすることで、
 ソートを行わずに出力します。標準ではtrueが設定されています。
</pre>
<p>

</p>
</div>
<div class="section">
<h2>1.5. UDFV toolsの使用メモリ量について</h2>
<p>
1.4で挙げている各サンプルでは、使用メモリ量を64Mとして指定しています(-Xmx64m)。ごく普通のDVD-VIDEO等のイメージであればこの設定で特に問題ありませんが、内部構造が複雑なイメージ(Extent数が極端に多いなど)の場合、64Mではメモリが不足する恐れがあります。</p>
<p>
メモリが足らなくなった場合、この値を適宜増やしてから再度実行してみてください。なお、samplesディレクトリに収録してあるテストスクリプトでは、この値は標準で大きなサイズを設定してあります。</p>
</div>
</body>
</html>
